[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756307","pull_request_review_id":3672453808,"id":2699756307,"node_id":"PRRC_kwDOQ4pSzs6g6wMT","diff_hunk":"@@ -7,53 +7,80 @@\n   @module Discourse\n **/\n Discourse.Group = Discourse.Model.extend({\n+  limit: 50,\n+  offset: 0,\n+  user_count: 0,\n \n   userCountDisplay: function(){\n     var c = this.get('user_count');\n     // don't display zero its ugly\n-    if(c > 0) {\n-      return c;\n-    }\n+    if (c > 0) { return c; }\n   }.property('user_count'),\n ","path":"app/assets/javascripts/discourse/models/group.js","commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","original_commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Return a promise from `findMembers` when group name is blank**\n\n`findMembers` now does `return ;` when `name` is empty, but callers (`setupController` in routes and the admin controller actions) call it without guarding; returning `Ember.RSVP.resolve([])` (as before) avoids a runtime `undefined.then` / async flow break when the route expects a promise.","created_at":"2026-01-16T19:43:32Z","updated_at":"2026-01-16T19:43:32Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756307","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756307"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756307"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756307/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":19,"original_line":19,"side":"RIGHT","author_association":"NONE","original_position":16,"position":16,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756472","pull_request_review_id":3672454054,"id":2699756472,"node_id":"PRRC_kwDOQ4pSzs6g6wO4","diff_hunk":"@@ -1,56 +1,43 @@\n class Admin::GroupsController < Admin::AdminController\n+\n   def index\n     groups = Group.order(:name)\n+\n     if search = params[:search]\n       search = search.to_s\n-      groups = groups.where(\"name ilike ?\", \"%#{search}%\")\n+      groups = groups.where(\"name ILIKE ?\", \"%#{search}%\")\n     end\n+\n     if params[:ignore_automatic].to_s == \"true\"\n       groups = groups.where(automatic: false)\n     end\n+\n     render_serialized(groups, BasicGroupSerializer)\n   end\n \n   def show\n     render nothing: true\n   end\n \n-  def refresh_automatic_groups\n-    Group.refresh_automatic_groups!\n-    render json: success_json\n-  end\n-\n-  def update_patch(group)\n-    raise Discourse::InvalidAccess.new(\"automatic groups do not permit membership changes\") if group.automatic\n+  def create\n+    group = Group.new","path":"app/controllers/admin/groups_controller.rb","commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","original_commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Keep request payload shape consistent between `create` and `update`**\n\nThe JS model posts raw fields (`{name, visible, alias_level}`), but `Admin::GroupsController#create` only handles `name` and `visible` (and never sets `alias_level`), while `#update` does handle `alias_level`; this causes newly-created groups to ignore the chosen alias level until a subsequent edit.","created_at":"2026-01-16T19:43:37Z","updated_at":"2026-01-16T19:43:37Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756472","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756472"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756472"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756472/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":23,"original_line":23,"side":"RIGHT","author_association":"NONE","original_position":31,"position":31,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756662","pull_request_review_id":3672454346,"id":2699756662,"node_id":"PRRC_kwDOQ4pSzs6g6wR2","diff_hunk":"@@ -48,97 +74,61 @@\n       response.status.should == 200\n       Group.where(id: group.id).count.should == 0\n     end\n+\n   end\n \n-  context '.create' do\n-    let(:usernames) { @admin.username }\n+  context \".refresh_automatic_groups\" do\n \n-    it \"is able to create a group\" do\n-      xhr :post, :create, group: {\n-        usernames: usernames,\n-        name: \"bob\"\n-      }\n+    it \"is able to refresh automatic groups\" do\n+      Group.expects(:refresh_automatic_groups!).returns(true)\n \n+      xhr :post, :refresh_automatic_groups\n       response.status.should == 200\n-\n-      groups = Group.where(name: \"bob\").to_a\n-\n-      groups.count.should == 1\n-      groups[0].usernames.should == usernames\n-      groups[0].name.should == \"bob\"\n     end\n \n-    it \"strips spaces from group name\" do\n-      lambda {\n-        xhr :post, :create, group: {\n-          usernames: usernames,\n-          name: \" bob \"\n-        }\n-      }.should_not raise_error()\n-      Group.where(name: \"bob\").count.should == 1\n-    end\n   end\n \n-  context '.update' do\n-    let (:group) { Fabricate(:group) }\n+  context \".add_members\" do\n \n-    it \"is able to update group members\" do\n+    it \"cannot add members to automatic groups\" do\n+      xhr :put, :add_members, group_id: 1, usernames: \"l77t\"\n+      response.status.should == 422\n+    end\n+\n+    it \"is able to add several members to a group\" do\n       user1 = Fabricate(:user)\n       user2 = Fabricate(:user)\n+      group = Fabricate(:group)\n \n-      xhr :put, :update, id: group.id, name: 'fred', group: {\n-            name: 'fred',\n-            usernames: \"#{user1.username},#{user2.username}\"\n-          }\n+      xhr :put, :add_members, group_id: group.id, usernames: [user1.username, user2.username].join(\",\")\n \n+      response.should be_success\n       group.reload\n       group.users.count.should == 2\n-      group.name.should == 'fred'\n     end\n \n-    context 'incremental' do\n-      before do\n-        @user1 = Fabricate(:user)\n-        group.add(@user1)\n-        group.reload\n-      end\n-\n-      it \"can make incremental adds\" do\n-        user2 = Fabricate(:user)\n-        xhr :patch, :update, id: group.id, changes: {add: user2.username}\n-        response.status.should == 200\n-        group.reload\n-        group.users.count.should eq(2)\n-      end\n-\n-      it \"succeeds silently when adding non-existent users\" do\n-        xhr :patch, :update, id: group.id, changes: {add: \"nosuchperson\"}\n-        response.status.should == 200\n-        group.reload\n-        group.users.count.should eq(1)\n-      end\n-\n-      it \"can make incremental deletes\" do\n-        xhr :patch, :update, id: group.id, changes: {delete: @user1.username}\n-        response.status.should == 200\n-        group.reload\n-        group.users.count.should eq(0)\n-      end\n-\n-      it \"succeeds silently when removing non-members\" do\n-        user2 = Fabricate(:user)\n-        xhr :patch, :update, id: group.id, changes: {delete: user2.username}\n-        response.status.should == 200\n-        group.reload\n-        group.users.count.should eq(1)\n-      end\n-\n-      it \"cannot patch automatic groups\" do\n-        auto_group = Fabricate(:group, name: \"auto_group\", automatic: true)\n-\n-        xhr :patch, :update, id: auto_group.id, changes: {add: \"bob\"}\n-        response.status.should == 403\n-      end\n+  end\n+\n+  context \".remove_member\" do\n+\n+    it \"cannot remove members from automatic groups\" do\n+      xhr :put, :remove_member, group_id: 1, user_id: 42\n+      response.status.should == 422\n+    end\n+\n+    it \"is able to remove a member\" do","path":"spec/controllers/admin/groups_controller_spec.rb","commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","original_commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Use DELETE for `remove_member` in spec (route is `delete \"members\"`)**\n\nThe spec calls `xhr :put, :remove_member` for the automatic-group case, but the route is registered as `DELETE /admin/groups/:group_id/members`; this will fail routing and wonâ€™t exercise the controller action.","created_at":"2026-01-16T19:43:41Z","updated_at":"2026-01-16T19:43:41Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756662","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756662"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756662"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":119,"original_line":119,"side":"RIGHT","author_association":"NONE","original_position":197,"position":197,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756862","pull_request_review_id":3672454597,"id":2699756862,"node_id":"PRRC_kwDOQ4pSzs6g6wU-","diff_hunk":"@@ -3,7 +3,7 @@\n     <tr>\n       <th colspan=\"3\" class=\"seen\">{{i18n 'last_seen'}}</th>\n     </tr>\n-  {{#each m in model}}\n+  {{#each m in members}}","path":"app/assets/javascripts/discourse/templates/group/members.hbs","commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","original_commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Fix members template binding (`members` is undefined here)**\n\nThis template switched from `model` to `members`, but the `group-members` route now sets `controller.model = group` (not an array) and `findMembers` populates `group.members`; without changing the template to iterate `model.members` (or adding a `members` alias on the controller), this renders nothing / errors.","created_at":"2026-01-16T19:43:46Z","updated_at":"2026-01-16T19:43:46Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756862","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756862"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699756862"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":6,"original_line":6,"side":"RIGHT","author_association":"NONE","original_position":5,"position":5,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699757048","pull_request_review_id":3672454821,"id":2699757048,"node_id":"PRRC_kwDOQ4pSzs6g6wX4","diff_hunk":"@@ -0,0 +1,4 @@\n+export default Discourse.View.extend({\n+  classNames: [\"item\"],\n+  templateName: \"admin/templates/group_member\"","path":"app/assets/javascripts/admin/views/group-member.js.es6","commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","original_commit_id":"060cda77729cb1c4a827560e09e89a7b22078ba9","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P1] Use the correct template name for the new admin view**\n\nIn Ember/Discourse, `templateName` usually matches the logical template path (e.g. `admin/templates/logs/...` in existing code). This file points at `admin/templates/group_member`, but the template was added at `app/assets/javascripts/admin/templates/group_member.hbs` (no `templates/` subdir), so the view may fail to resolve its template at runtime.","created_at":"2026-01-16T19:43:50Z","updated_at":"2026-01-16T19:43:50Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699757048","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699757048"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/8#discussion_r2699757048"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699757048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":3,"original_line":3,"side":"RIGHT","author_association":"NONE","original_position":3,"position":3,"subject_type":"line"}]