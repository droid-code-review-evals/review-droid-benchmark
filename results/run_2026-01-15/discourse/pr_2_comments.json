[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755962","pull_request_review_id":3672453369,"id":2699755962,"node_id":"PRRC_kwDOQ4pSzs6g6wG6","diff_hunk":"@@ -0,0 +1,9 @@\n+import ObjectController from \"discourse/controllers/object\";\n+\n+export default ObjectController.extend({\n+\n+  stopNotificiationsText: function() {","path":"app/assets/javascripts/discourse/controllers/topic-unsubscribe.js.es6","commit_id":"6669a2d94d76eea3b99b8c476d12b1eb66726b07","original_commit_id":"6669a2d94d76eea3b99b8c476d12b1eb66726b07","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P1] Avoid XSS by not triple-stashing translated HTML with user title**\n\n`I18n.t(... { title: model.fancyTitle })` injects a user-controlled title into a translation that includes `<strong>...</strong>`, and the template renders it via `{{{...}}}`; if `fancyTitle` contains HTML, this becomes an XSS vector.","created_at":"2026-01-16T19:43:24Z","updated_at":"2026-01-16T19:43:24Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/2#discussion_r2699755962","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/2","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755962"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/2#discussion_r2699755962"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/2"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":5,"original_line":5,"side":"RIGHT","author_association":"NONE","original_position":5,"position":5,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755963","pull_request_review_id":3672453370,"id":2699755963,"node_id":"PRRC_kwDOQ4pSzs6g6wG7","diff_hunk":"@@ -94,6 +95,26 @@ def show\n     raise ex\n   end\n \n+  def unsubscribe\n+    @topic_view = TopicView.new(params[:topic_id], current_user)\n+\n+    if slugs_do_not_match || (!request.format.json? && params[:slug].blank?)\n+      return redirect_to @topic_view.topic.unsubscribe_url, status: 301","path":"app/controllers/topics_controller.rb","commit_id":"6669a2d94d76eea3b99b8c476d12b1eb66726b07","original_commit_id":"6669a2d94d76eea3b99b8c476d12b1eb66726b07","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Guard against nil `current_user`/`TopicUser` in unsubscribe**\n\n`TopicView.new(..., current_user)` and `TopicUser.find_by(user_id: current_user.id, ...)` will crash for anonymous users (and `tu` can be `nil`), so hitting `/t/:id/unsubscribe` without being logged in currently raises `NoMethodError`.","created_at":"2026-01-16T19:43:24Z","updated_at":"2026-01-16T19:43:24Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/2#discussion_r2699755963","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/2","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755963"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/2#discussion_r2699755963"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/2"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":102,"original_line":102,"side":"RIGHT","author_association":"NONE","original_position":23,"position":23,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756145","pull_request_review_id":3672453612,"id":2699756145,"node_id":"PRRC_kwDOQ4pSzs6g6wJx","diff_hunk":"@@ -0,0 +1,8 @@\n+<div class=\"container\">\n+  <p>\n+    {{{stopNotificiationsText}}}\n+  </p>","path":"app/assets/javascripts/discourse/templates/topic/unsubscribe.hbs","commit_id":"6669a2d94d76eea3b99b8c476d12b1eb66726b07","original_commit_id":"6669a2d94d76eea3b99b8c476d12b1eb66726b07","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P2] Fix misspelled property name (notifications)**\n\nThe controller/template property is spelled `stopNotificiationsText` (extra \"i\"). This is easy to accidentally reference as `stopNotificationsText` elsewhere, causing the unsubscribe page to render blank text.","created_at":"2026-01-16T19:43:28Z","updated_at":"2026-01-16T19:43:28Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/2#discussion_r2699756145","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/2","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756145"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/2#discussion_r2699756145"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/2"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":4,"original_line":4,"side":"RIGHT","author_association":"NONE","original_position":4,"position":4,"subject_type":"line"}]