[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761413","pull_request_review_id":3672460495,"id":2699761413,"node_id":"PRRC_kwDOQ4pSzs6g6xcF","diff_hunk":"@@ -0,0 +1,33 @@\n+class CreateEmbeddableHosts < ActiveRecord::Migration\n+  def change\n+    create_table :embeddable_hosts, force: true do |t|\n+      t.string :host, null: false\n+      t.integer :category_id, null: false\n+      t.timestamps\n+    end\n+\n+    category_id = execute(\"SELECT c.id FROM categories AS c","path":"db/migrate/20150818190757_create_embeddable_hosts.rb","commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","original_commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P0] Fix migration query that can crash when embed_category is unset\n\n`execute(...)[0]['id']` will raise when the SELECT returns 0 rows (common if `embed_category` was never configured). Guard for an empty result before indexing, or use a query that returns NULL safely.","created_at":"2026-01-16T19:45:27Z","updated_at":"2026-01-16T19:45:27Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699761413","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761413"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699761413"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":9,"original_line":9,"side":"RIGHT","author_association":"NONE","original_position":9,"position":9,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761678","pull_request_review_id":3672460891,"id":2699761678,"node_id":"PRRC_kwDOQ4pSzs6g6xgO","diff_hunk":"@@ -0,0 +1,33 @@\n+class CreateEmbeddableHosts < ActiveRecord::Migration\n+  def change\n+    create_table :embeddable_hosts, force: true do |t|\n+      t.string :host, null: false\n+      t.integer :category_id, null: false\n+      t.timestamps\n+    end\n+\n+    category_id = execute(\"SELECT c.id FROM categories AS c\n+                        INNER JOIN site_settings AS s ON s.value = c.name\n+                        WHERE s.name = 'embed_category'\")[0]['id'].to_i\n+\n+\n+    if category_id == 0\n+      category_id = execute(\"SELECT value FROM site_settings WHERE name = 'uncategorized_category_id'\")[0]['value'].to_i\n+    end\n+\n+    embeddable_hosts = execute(\"SELECT value FROM site_settings WHERE name = 'embeddable_hosts'\")\n+    if embeddable_hosts && embeddable_hosts.cmd_tuples > 0\n+      val = embeddable_hosts[0]['value']\n+      if val.present?\n+        records = val.split(\"\\n\")\n+        if records.present?","path":"db/migrate/20150818190757_create_embeddable_hosts.rb","commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","original_commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P0] Avoid SQL injection / breakage when inserting hosts\n\nThis interpolates `h` directly into SQL, so a host containing `'` will break the migration and could be exploited if the setting was compromised. Use `quote(h)` / `exec_insert` / prepared statements instead of string interpolation.","created_at":"2026-01-16T19:45:32Z","updated_at":"2026-01-16T19:45:32Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699761678","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761678"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699761678"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":23,"original_line":23,"side":"RIGHT","author_association":"NONE","original_position":23,"position":23,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761941","pull_request_review_id":3672461145,"id":2699761941,"node_id":"PRRC_kwDOQ4pSzs6g6xkV","diff_hunk":"@@ -1,27 +1,4 @@\n-Fabricator(:category) do\n-  name { sequence(:name) { |n| \"Amazing Category #{n}\" } }\n-  user\n-end\n-\n-Fabricator(:diff_category, from: :category) do\n-  name \"Different Category\"\n-  user\n-end\n-\n-Fabricator(:happy_category, from: :category) do\n-  name 'Happy Category'\n-  slug 'happy'\n-  user\n-end\n-\n-Fabricator(:private_category, from: :category) do\n-  transient :group\n-\n-  name 'Private Category'\n-  slug 'private'\n-  user\n-  after_build do |cat, transients|\n-    cat.update!(read_restricted: true)\n-    cat.category_groups.build(group_id: transients[:group].id, permission_type: CategoryGroup.permission_types[:full])\n-  end\n+Fabricator(:embeddable_host) do","path":"spec/fabricators/category_fabricator.rb","commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","original_commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P0] Restore `category` fabricators; current file defines the wrong fabricator\n\nThis file now defines `Fabricator(:embeddable_host)` instead of `Fabricator(:category)`, while `spec/fabricators/embeddable_host_fabricator.rb` contains the category fabricators. Any spec calling `Fabricate(:category)` will now fail (as already used widely across `spec/`).","created_at":"2026-01-16T19:45:38Z","updated_at":"2026-01-16T19:45:38Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699761941","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761941"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699761941"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699761941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":1,"original_line":1,"side":"RIGHT","author_association":"NONE","original_position":27,"position":27,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699762216","pull_request_review_id":3672461510,"id":2699762216,"node_id":"PRRC_kwDOQ4pSzs6g6xoo","diff_hunk":"@@ -189,14 +189,24 @@ export default Ember.Object.extend({\n   _hydrateEmbedded(type, obj, root) {\n     const self = this;\n     Object.keys(obj).forEach(function(k) {\n-      const m = /(.+)\\_id$/.exec(k);\n+      const m = /(.+)\\_id(s?)$/.exec(k);\n       if (m) {\n         const subType = m[1];\n-        const hydrated = self._lookupSubType(subType, type, obj[k], root);\n-        if (hydrated) {\n-          obj[subType] = hydrated;\n+\n+        if (m[2]) {\n+          const hydrated = obj[k].map(function(id) {\n+            return self._lookupSubType(subType, type, id, root);","path":"app/assets/javascripts/discourse/models/store.js.es6","commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","original_commit_id":"d1c69189f3c90ecf56013a8da904da9bff9a8e19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P1] Don’t delete `*_ids` when hydration returns nulls\n\nFor plural hydration, `_lookupSubType` can return `null`/`undefined` for missing ids, but this branch always deletes `obj[k]` and sets `obj[plural]` to an array containing nulls. This can break consumers expecting ids to remain when the related records weren’t included.","created_at":"2026-01-16T19:45:42Z","updated_at":"2026-01-16T19:45:42Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699762216","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699762216"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/10#discussion_r2699762216"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/10"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699762216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":198,"original_line":198,"side":"RIGHT","author_association":"NONE","original_position":14,"position":14,"subject_type":"line"}]