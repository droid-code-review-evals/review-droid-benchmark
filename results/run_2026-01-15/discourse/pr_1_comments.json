[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755507","pull_request_review_id":3672452823,"id":2699755507,"node_id":"PRRC_kwDOQ4pSzs6g6v_z","diff_hunk":"@@ -139,25 +139,24 @@ def self.downsize_instructions_animated(from, to, dimensions, opts={})\n   end\n \n   def self.resize(from, to, width, height, opts={})\n-    optimize(\"resize\", from, to, width, height, opts)\n+    optimize(\"resize\", from, to, \"#{width}x#{height}\", opts)\n   end\n \n   def self.downsize(from, to, max_width, max_height, opts={})","path":"app/models/optimized_image.rb","commit_id":"ffbaf8c54269df2ce510de91245760fddce09896","original_commit_id":"ffbaf8c54269df2ce510de91245760fddce09896","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P0] Remove duplicate `downsize` method definition\n\nRuby will overwrite the first `def self.downsize(from, to, max_width, max_height, ...)` with the later `def self.downsize(from, to, dimensions, ...)`, so existing callers like `OptimizedImage.downsize(path, path, 100, 100, opts)` will hit the wrong arity and raise `ArgumentError` at runtime.","created_at":"2026-01-16T19:43:12Z","updated_at":"2026-01-16T19:43:12Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/1#discussion_r2699755507","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/1","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755507"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/1#discussion_r2699755507"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/1"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755507/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":145,"original_line":145,"side":"RIGHT","author_association":"NONE","original_position":8,"position":8,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755513","pull_request_review_id":3672452827,"id":2699755513,"node_id":"PRRC_kwDOQ4pSzs6g6v_5","diff_hunk":"@@ -52,14 +52,23 @@ def create_upload(type, file, url)\n     begin\n       # API can provide a URL\n       if file.nil? && url.present? && is_api?\n-        tempfile = FileHelper.download(url, SiteSetting.max_image_size_kb.kilobytes, \"discourse-upload-#{type}\") rescue nil\n+        tempfile = FileHelper.download(url, 10.megabytes, \"discourse-upload-#{type}\") rescue nil\n         filename = File.basename(URI.parse(url).path)\n       else\n         tempfile = file.tempfile\n         filename = file.original_filename\n         content_type = file.content_type\n       end\n \n+      # allow users to upload large images that will be automatically reduced to allowed size\n+      if tempfile && tempfile.size > 0 && SiteSetting.max_image_size_kb > 0 && FileHelper.is_image?(filename)\n+        attempt = 5\n+        while attempt > 0 && tempfile.size > SiteSetting.max_image_size_kb.kilobytes\n+          OptimizedImage.downsize(tempfile.path, tempfile.path, \"80%\", allow_animation: SiteSetting.allow_animated_thumbnails)","path":"app/controllers/uploads_controller.rb","commit_id":"ffbaf8c54269df2ce510de91245760fddce09896","original_commit_id":"ffbaf8c54269df2ce510de91245760fddce09896","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P1] Fix `OptimizedImage.downsize` call signature\n\n`OptimizedImage.downsize` expects dimensions like `\"<w>x<h>\"` (or `max_width, max_height`), but this passes `\"80%\"` as the 3rd arg; with the duplicate method definitions in `OptimizedImage` this will also raise `ArgumentError` for the 5-arg call pattern elsewhere.","created_at":"2026-01-16T19:43:12Z","updated_at":"2026-01-16T19:43:12Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/1#discussion_r2699755513","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/1","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755513"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/1#discussion_r2699755513"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/1"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699755513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":67,"original_line":67,"side":"RIGHT","author_association":"NONE","original_position":17,"position":17,"subject_type":"line"}]