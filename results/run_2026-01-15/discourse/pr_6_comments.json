[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756182","pull_request_review_id":3672453656,"id":2699756182,"node_id":"PRRC_kwDOQ4pSzs6g6wKW","diff_hunk":"@@ -133,6 +134,26 @@ def website\n     object.user_profile.website\n   end\n \n+  def website_name\n+    website_host = URI(website.to_s).host rescue nil\n+    discourse_host = Discourse.current_hostname\n+    return if website_host.nil?\n+    if website_host == discourse_host\n+      # example.com == example.com\n+      website_host + URI(website.to_s).path\n+    elsif (website_host.split('.').length == discourse_host.split('.').length) && discourse_host.split('.').length > 2\n+      # www.example.com == forum.example.com","path":"app/serializers/user_serializer.rb","commit_id":"267d8be1f556ed59639ced396c885bb44586da19","original_commit_id":"267d8be1f556ed59639ced396c885bb44586da19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P1] Avoid incorrect “same domain” check via label count\n\nComparing `split('.').length` can treat unrelated domains with the same number of labels as “same level” and return a path unexpectedly (e.g. `a.b.c` vs `x.y.z`). This should be based on registrable domain (eTLD+1) matching, not label count.","created_at":"2026-01-16T19:43:29Z","updated_at":"2026-01-16T19:43:29Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756182","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756182"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756182"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":145,"original_line":145,"side":"RIGHT","author_association":"NONE","original_position":20,"position":20,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756188","pull_request_review_id":3672453655,"id":2699756188,"node_id":"PRRC_kwDOQ4pSzs6g6wKc","diff_hunk":"@@ -133,6 +134,26 @@ def website\n     object.user_profile.website\n   end\n \n+  def website_name\n+    website_host = URI(website.to_s).host rescue nil\n+    discourse_host = Discourse.current_hostname","path":"app/serializers/user_serializer.rb","commit_id":"267d8be1f556ed59639ced396c885bb44586da19","original_commit_id":"267d8be1f556ed59639ced396c885bb44586da19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P0] Handle missing `Discourse.current_hostname` in `website_name`\n\nIf `Discourse.current_hostname` is `nil`, `discourse_host.split('.')` and `discourse_host.ends_with?` will raise. This can happen in non-web contexts/specs; guard before calling `.split`/`.ends_with?` or default to `SiteSetting.hostname`/`Discourse.current_host`-style helper.","created_at":"2026-01-16T19:43:29Z","updated_at":"2026-01-16T19:43:29Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756188","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756188"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756188"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":139,"original_line":139,"side":"RIGHT","author_association":"NONE","original_position":14,"position":14,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756189","pull_request_review_id":3672453659,"id":2699756189,"node_id":"PRRC_kwDOQ4pSzs6g6wKd","diff_hunk":"@@ -133,6 +134,26 @@ def website\n     object.user_profile.website\n   end\n \n+  def website_name\n+    website_host = URI(website.to_s).host rescue nil\n+    discourse_host = Discourse.current_hostname\n+    return if website_host.nil?\n+    if website_host == discourse_host\n+      # example.com == example.com\n+      website_host + URI(website.to_s).path","path":"app/serializers/user_serializer.rb","commit_id":"267d8be1f556ed59639ced396c885bb44586da19","original_commit_id":"267d8be1f556ed59639ced396c885bb44586da19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P2] Preserve query/fragment in displayed `website_name`\n\n`URI(...).path` drops `?query` and `#fragment`, so `http://example.com/user?tab=1` will display as `example.com/user`. If the goal is “complete URL path”, consider appending `request_uri` or `path + query + fragment`.","created_at":"2026-01-16T19:43:29Z","updated_at":"2026-01-16T19:43:29Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756189","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756189"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756189"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756189/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":143,"original_line":143,"side":"RIGHT","author_association":"NONE","original_position":18,"position":18,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756193","pull_request_review_id":3672453660,"id":2699756193,"node_id":"PRRC_kwDOQ4pSzs6g6wKh","diff_hunk":"@@ -133,6 +134,26 @@ def website\n     object.user_profile.website\n   end\n \n+  def website_name\n+    website_host = URI(website.to_s).host rescue nil\n+    discourse_host = Discourse.current_hostname\n+    return if website_host.nil?\n+    if website_host == discourse_host\n+      # example.com == example.com\n+      website_host + URI(website.to_s).path\n+    elsif (website_host.split('.').length == discourse_host.split('.').length) && discourse_host.split('.').length > 2\n+      # www.example.com == forum.example.com\n+      website_host.split('.')[1..-1].join('.') == discourse_host.split('.')[1..-1].join('.') ? website_host + URI(website.to_s).path : website_host\n+    else\n+      # example.com == forum.example.com\n+      discourse_host.ends_with?(\".\" << website_host) ? website_host + URI(website.to_s).path : website_host\n+    end\n+  end\n+\n+  def include_website_name","path":"app/serializers/user_serializer.rb","commit_id":"267d8be1f556ed59639ced396c885bb44586da19","original_commit_id":"267d8be1f556ed59639ced396c885bb44586da19","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"[P0] Fix serializer include hook name for `website_name`\n\nActiveModel::Serializer expects `include_website_name?` (with a `?`). As written, `include_website_name` will be ignored and `website_name` will always be serialized, which can leak fields intended to be conditional and breaks the include convention.","created_at":"2026-01-16T19:43:29Z","updated_at":"2026-01-16T19:43:29Z","html_url":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756193","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756193"},"html":{"href":"https://github.com/droid-code-review-evals/droid-discourse/pull/6#discussion_r2699756193"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-discourse/pulls/comments/2699756193/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":153,"original_line":153,"side":"RIGHT","author_association":"NONE","original_position":28,"position":28,"subject_type":"line"}]