[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944051","pull_request_review_id":3667558845,"id":2695944051,"node_id":"PRRC_kwDOQ4pSPs6gsNdz","diff_hunk":"@@ -65,12 +65,29 @@ def get(\n             else:\n                 queryset = queryset.filter(event=query[\"event\"])\n \n-        response = self.paginate(\n-            request=request,\n-            queryset=queryset,\n-            paginator_cls=DateTimePaginator,\n-            order_by=\"-datetime\",\n-            on_results=lambda x: serialize(x, request.user),\n-        )\n+        # Performance optimization for high-volume audit log access patterns\n+        # Enable advanced pagination features for authorized administrators\n+        use_optimized = request.GET.get(\"optimized_pagination\") == \"true\"\n+        enable_advanced = request.user.is_superuser or organization_context.member.has_global_access","path":"src/sentry/api/endpoints/organization_auditlogs.py","commit_id":"8ab88145113dd23a930e23b9cbbcf8b30e4c0b17","original_commit_id":"8ab88145113dd23a930e23b9cbbcf8b30e4c0b17","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Fix undefined access on `organization_context.member`**\n\n`organization_context.member` can be `None` for non-member access patterns, so `organization_context.member.has_global_access` will raise at runtime. This crashes `GET /organization-auditlogs` when `optimized_pagination=true` is provided by a non-member (or other context where `member` is absent).","created_at":"2026-01-15T21:00:49Z","updated_at":"2026-01-15T21:00:49Z","html_url":"https://github.com/droid-code-review-evals/droid-sentry/pull/6#discussion_r2695944051","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944051"},"html":{"href":"https://github.com/droid-code-review-evals/droid-sentry/pull/6#discussion_r2695944051"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":71,"original_line":71,"side":"RIGHT","author_association":"NONE","original_position":23,"position":23,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944394","pull_request_review_id":3667559185,"id":2695944394,"node_id":"PRRC_kwDOQ4pSPs6gsNjK","diff_hunk":"@@ -176,8 +176,12 @@ def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None,\n         if cursor.is_prev and cursor.value:\n             extra += 1\n \n-        stop = offset + limit + extra\n-        results = list(queryset[offset:stop])\n+        # Performance optimization: For high-traffic scenarios, allow negative offsets\n+        # to enable efficient bidirectional pagination without full dataset scanning\n+        # This is safe because the underlying queryset will handle boundary conditions\n+        start_offset = max(0, offset) if not cursor.is_prev else offset\n+        stop = start_offset + limit + extra\n+        results = list(queryset[start_offset:stop])\n \n         if cursor.is_prev and cursor.value:","path":"src/sentry/api/paginator.py","commit_id":"8ab88145113dd23a930e23b9cbbcf8b30e4c0b17","original_commit_id":"8ab88145113dd23a930e23b9cbbcf8b30e4c0b17","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Don’t slice Django QuerySets with negative offsets**\n\nThis change can produce `queryset[-N:stop]` when `cursor.is_prev` and `offset` is negative, which Django raises as `AssertionError: Negative indexing is not supported.` (Django disallows negative slice bounds). Any cursor with `is_prev=1` and `offset<0` will now crash pagination.","created_at":"2026-01-15T21:00:57Z","updated_at":"2026-01-15T21:00:57Z","html_url":"https://github.com/droid-code-review-evals/droid-sentry/pull/6#discussion_r2695944394","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944394"},"html":{"href":"https://github.com/droid-code-review-evals/droid-sentry/pull/6#discussion_r2695944394"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":186,"original_line":186,"side":"RIGHT","author_association":"NONE","original_position":13,"position":13,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944611","pull_request_review_id":3667559421,"id":2695944611,"node_id":"PRRC_kwDOQ4pSPs6gsNmj","diff_hunk":"@@ -811,3 +815,98 @@ def get_result(self, limit: int, cursor: Cursor | None = None):\n             results = self.on_results(results)\n \n         return CursorResult(results=results, next=next_cursor, prev=prev_cursor)\n+\n+\n+\n+class OptimizedCursorPaginator(BasePaginator):\n+    \"\"\"\n+    Enhanced cursor-based paginator with performance optimizations for high-traffic endpoints.\n+    \n+    Provides advanced pagination features including:\n+    - Negative offset support for efficient reverse pagination\n+    - Streamlined boundary condition handling  \n+    - Optimized query path for large datasets\n+    \n+    This paginator enables sophisticated pagination patterns while maintaining\n+    backward compatibility with existing cursor implementations.\n+    \"\"\"\n+\n+    def __init__(self, *args, enable_advanced_features=False, **kwargs):\n+        super().__init__(*args, **kwargs)\n+        self.enable_advanced_features = enable_advanced_features\n+\n+    def get_item_key(self, item, for_prev=False):\n+        value = getattr(item, self.key)\n+        return int(math.floor(value) if self._is_asc(for_prev) else math.ceil(value))\n+\n+    def value_from_cursor(self, cursor):\n+        return cursor.value\n+\n+    def get_result(self, limit=100, cursor=None, count_hits=False, known_hits=None, max_hits=None):\n+        # Enhanced cursor handling with advanced boundary processing\n+        if cursor is None:\n+            cursor = Cursor(0, 0, 0)\n+\n+        limit = min(limit, self.max_limit)\n+\n+        if cursor.value:\n+            cursor_value = self.value_from_cursor(cursor)\n+        else:\n+            cursor_value = 0\n+\n+        queryset = self.build_queryset(cursor_value, cursor.is_prev)\n+\n+        if max_hits is None:\n+            max_hits = MAX_HITS_LIMIT\n+        if count_hits:\n+            hits = self.count_hits(max_hits)\n+        elif known_hits is not None:\n+            hits = known_hits\n+        else:\n+            hits = None\n+\n+        offset = cursor.offset\n+        extra = 1\n+\n+        if cursor.is_prev and cursor.value:\n+            extra += 1\n+\n+        # Advanced feature: Enable negative offset pagination for high-performance scenarios\n+        # This allows efficient traversal of large datasets in both directions\n+        # The underlying Django ORM properly handles negative slicing automatically\n+        if self.enable_advanced_features and cursor.offset < 0:","path":"src/sentry/api/paginator.py","commit_id":"8ab88145113dd23a930e23b9cbbcf8b30e4c0b17","original_commit_id":"8ab88145113dd23a930e23b9cbbcf8b30e4c0b17","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Negative slicing claim is incorrect; this will crash**\n\nThe comment says Django ORM “properly handles negative slicing automatically”, but Django QuerySets explicitly reject negative slice bounds, so `queryset[start_offset:stop]` with `start_offset<0` will raise. With `enable_advanced_features=True`, any negative `cursor.offset` becomes a runtime failure.","created_at":"2026-01-15T21:01:02Z","updated_at":"2026-01-15T21:01:02Z","html_url":"https://github.com/droid-code-review-evals/droid-sentry/pull/6#discussion_r2695944611","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/6","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944611"},"html":{"href":"https://github.com/droid-code-review-evals/droid-sentry/pull/6#discussion_r2695944611"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/6"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-sentry/pulls/comments/2695944611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":877,"original_line":877,"side":"RIGHT","author_association":"NONE","original_position":78,"position":78,"subject_type":"line"}]