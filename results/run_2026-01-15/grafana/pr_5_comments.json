[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699750997","pull_request_review_id":3672447084,"id":2699750997,"node_id":"PRRC_kwDOQ4pSe86g6u5V","diff_hunk":"@@ -263,62 +275,136 @@ export function useAllAlertRuleAbilities(rule: CombinedRule): Abilities<AlertRul\n     };\n \n     return abilities;\n-  }, [rule, loading, isRulerAvailable, isEditable, isRemovable, rulesSourceName, exportAllowed, canSilence]);\n+  }, [rule, loading, isRulerAvailable, rulesSourceName, isEditable, isRemovable, canSilence, exportAllowed]);\n \n   return abilities;\n }\n \n-export function useAllRulerRuleAbilities(\n-  rule: RulerRuleDTO | undefined,\n-  groupIdentifier: RuleGroupIdentifierV2\n-): Abilities<AlertRuleAction> {\n-  const rulesSourceName = getGroupOriginName(groupIdentifier);\n-\n-  const { isEditable, isRemovable, isRulerAvailable = false, loading } = useIsRuleEditable(rulesSourceName, rule);\n+/**\n+ * Hook for checking abilities on Grafana Prometheus rules (GrafanaPromRuleDTO)\n+ * This is the next version of useAllRulerRuleAbilities designed to work with GrafanaPromRuleDTO\n+ */\n+export function useAllGrafanaPromRuleAbilities(rule: GrafanaPromRuleDTO | undefined): Abilities<AlertRuleAction> {\n+  // For GrafanaPromRuleDTO, we use useIsGrafanaPromRuleEditable instead\n+  const { isEditable, isRemovable, loading } = useIsGrafanaPromRuleEditable(rule); // duplicate\n   const [_, exportAllowed] = useAlertingAbility(AlertingAction.ExportGrafanaManagedRules);\n-  const canSilence = useCanSilence(rule);\n+\n+  const silenceSupported = useGrafanaRulesSilenceSupport();\n+  const canSilenceInFolder = useCanSilenceInFolder(rule?.folderUid);\n \n   const abilities = useMemo<Abilities<AlertRuleAction>>(() => {\n-    const isProvisioned = rulerRuleType.grafana.rule(rule) && Boolean(rule.grafana_alert.provenance);\n-    // const isFederated = isFederatedRuleGroup();\n+    const isProvisioned = rule ? isProvisionedPromRule(rule) : false;\n+\n+    // Note: Grafana managed rules can't be federated - this is strictly a Mimir feature\n+    // See: https://grafana.com/docs/mimir/latest/references/architecture/components/ruler/#federated-rule-groups\n     const isFederated = false;\n-    const isGrafanaManagedAlertRule = rulerRuleType.grafana.rule(rule);\n+    // All GrafanaPromRuleDTO rules are Grafana-managed by definition\n+    const isAlertingRule = prometheusRuleType.grafana.alertingRule(rule);\n     const isPluginProvided = isPluginProvidedRule(rule);\n \n     // if a rule is either provisioned, federated or provided by a plugin rule, we don't allow it to be removed or edited\n     const immutableRule = isProvisioned || isFederated || isPluginProvided;\n \n-    // while we gather info, pretend it's not supported\n-    const MaybeSupported = loading ? NotSupported : isRulerAvailable;\n+    // GrafanaPromRuleDTO rules are always supported (no loading state for ruler availability)\n+    const MaybeSupported = loading ? NotSupported : AlwaysSupported;\n     const MaybeSupportedUnlessImmutable = immutableRule ? NotSupported : MaybeSupported;\n \n     // Creating duplicates of plugin-provided rules does not seem to make a lot of sense\n     const duplicateSupported = isPluginProvided ? NotSupported : MaybeSupported;\n \n-    const rulesPermissions = getRulesPermissions(rulesSourceName);\n+    const rulesPermissions = getRulesPermissions('grafana');\n \n     const abilities: Abilities<AlertRuleAction> = {\n       [AlertRuleAction.Duplicate]: toAbility(duplicateSupported, rulesPermissions.create),\n       [AlertRuleAction.View]: toAbility(AlwaysSupported, rulesPermissions.read),\n       [AlertRuleAction.Update]: [MaybeSupportedUnlessImmutable, isEditable ?? false],\n       [AlertRuleAction.Delete]: [MaybeSupportedUnlessImmutable, isRemovable ?? false],\n       [AlertRuleAction.Explore]: toAbility(AlwaysSupported, AccessControlAction.DataSourcesExplore),\n-      [AlertRuleAction.Silence]: canSilence,\n-      [AlertRuleAction.ModifyExport]: [isGrafanaManagedAlertRule, exportAllowed],\n-      [AlertRuleAction.Pause]: [MaybeSupportedUnlessImmutable && isGrafanaManagedAlertRule, isEditable ?? false],\n-      [AlertRuleAction.Restore]: [MaybeSupportedUnlessImmutable && isGrafanaManagedAlertRule, isEditable ?? false],\n+      [AlertRuleAction.Silence]: [silenceSupported, canSilenceInFolder && isAlertingRule],\n+      [AlertRuleAction.ModifyExport]: [isAlertingRule, exportAllowed],\n+      [AlertRuleAction.Pause]: [MaybeSupportedUnlessImmutable && isAlertingRule, isEditable ?? false],\n+      [AlertRuleAction.Restore]: [MaybeSupportedUnlessImmutable && isAlertingRule, isEditable ?? false],\n       [AlertRuleAction.DeletePermanently]: [\n-        MaybeSupportedUnlessImmutable && isGrafanaManagedAlertRule,\n+        MaybeSupportedUnlessImmutable && isAlertingRule,\n         (isRemovable && isAdmin()) ?? false,\n       ],\n     };\n \n     return abilities;\n-  }, [rule, loading, isRulerAvailable, rulesSourceName, isEditable, isRemovable, canSilence, exportAllowed]);\n+  }, [rule, loading, isEditable, isRemovable, canSilenceInFolder, exportAllowed, silenceSupported]);\n \n   return abilities;\n }\n \n+interface IsGrafanaPromRuleEditableResult {\n+  isEditable: boolean;\n+  isRemovable: boolean;\n+  loading: boolean;\n+}\n+\n+/**\n+ * Hook for checking if a GrafanaPromRuleDTO is editable","path":"public/app/features/alerting/unified/hooks/useAbilities.ts","commit_id":"3e6d620d2c1d1f6c10611fba8b0ee062d6fb2a68","original_commit_id":"3e6d620d2c1d1f6c10611fba8b0ee062d6fb2a68","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Define or import `ctx` in `useIsGrafanaPromRuleEditable`**\n\n`useIsGrafanaPromRuleEditable` calls `ctx.hasPermissionInMetadata(...)`, but `ctx` isn’t defined in this module scope, which will throw at runtime. Use the same context source used elsewhere in this file (e.g. whatever provides `ctx`) or pass it in.","created_at":"2026-01-16T19:41:29Z","updated_at":"2026-01-16T19:41:29Z","html_url":"https://github.com/droid-code-review-evals/droid-grafana/pull/5#discussion_r2699750997","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/5","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699750997"},"html":{"href":"https://github.com/droid-code-review-evals/droid-grafana/pull/5#discussion_r2699750997"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/5"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699750997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":346,"original_line":346,"side":"RIGHT","author_association":"NONE","original_position":180,"position":180,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699750998","pull_request_review_id":3672447083,"id":2699750998,"node_id":"PRRC_kwDOQ4pSe86g6u5W","diff_hunk":"@@ -0,0 +1,71 @@\n+import { GrafanaRuleGroupIdentifier } from 'app/types/unified-alerting';\n+import { GrafanaPromRuleDTO, PromRuleType } from 'app/types/unified-alerting-dto';\n+\n+import { GrafanaRulesSource } from '../utils/datasource';\n+import { totalFromStats } from '../utils/ruleStats';\n+import { prometheusRuleType } from '../utils/rules';\n+import { createRelativeUrl } from '../utils/url';\n+\n+import {\n+  AlertRuleListItem,\n+  RecordingRuleListItem,\n+  RuleListItemCommonProps,\n+  UnknownRuleListItem,\n+} from './components/AlertRuleListItem';\n+import { RuleActionsButtons } from './components/RuleActionsButtons.V2';\n+import { RuleOperation } from './components/RuleListIcon';\n+\n+interface GrafanaRuleListItemProps {\n+  rule: GrafanaPromRuleDTO;\n+  groupIdentifier: GrafanaRuleGroupIdentifier;\n+  namespaceName: string;\n+  operation?: RuleOperation;\n+  showLocation?: boolean;\n+}\n+\n+export function GrafanaRuleListItem({\n+  rule,\n+  groupIdentifier,\n+  namespaceName,\n+  operation,\n+  showLocation = true,","path":"public/app/features/alerting/unified/rule-list/GrafanaRuleListItem.tsx","commit_id":"3e6d620d2c1d1f6c10611fba8b0ee062d6fb2a68","original_commit_id":"3e6d620d2c1d1f6c10611fba8b0ee062d6fb2a68","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P1] Use rule title instead of `name` for Grafana-managed rules**\n\n`GrafanaPromRuleDTO`’s display name is typically in `rule.annotations?.title` (the old path used `rulerRule.grafana_alert.title`), but this component uses `rule.name`, which can differ and will change UI text and selectors unexpectedly.","created_at":"2026-01-16T19:41:29Z","updated_at":"2026-01-16T19:41:29Z","html_url":"https://github.com/droid-code-review-evals/droid-grafana/pull/5#discussion_r2699750998","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/5","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699750998"},"html":{"href":"https://github.com/droid-code-review-evals/droid-grafana/pull/5#discussion_r2699750998"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/5"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699750998/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":31,"original_line":31,"side":"RIGHT","author_association":"NONE","original_position":31,"position":31,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699751804","pull_request_review_id":3672448497,"id":2699751804,"node_id":"PRRC_kwDOQ4pSe86g6vF8","diff_hunk":"@@ -48,20 +39,8 @@ export function GrafanaGroupLoader({\n     },\n     { pollingInterval: RULE_LIST_POLL_INTERVAL_MS }\n   );\n-  const { data: rulerResponse, isLoading: isRulerGroupLoading } = useGetGrafanaRulerGroupQuery({\n-    folderUid: groupIdentifier.namespace.uid,\n-    groupName: groupIdentifier.groupName,\n-  });\n-\n-  const { matches, promOnlyRules } = useMemo(() => {\n-    const promRules = promResponse?.data.groups.at(0)?.rules ?? [];\n-    const rulerRules = rulerResponse?.rules ?? [];\n-\n-    return matchRules(promRules, rulerRules);\n-  }, [promResponse, rulerResponse]);\n \n-  const isLoading = isPromResponseLoading || isRulerGroupLoading;\n-  if (isLoading) {\n+  if (isPromResponseLoading) {","path":"public/app/features/alerting/unified/rule-list/GrafanaGroupLoader.tsx","commit_id":"3e6d620d2c1d1f6c10611fba8b0ee062d6fb2a68","original_commit_id":"3e6d620d2c1d1f6c10611fba8b0ee062d6fb2a68","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Fix missing `t` import (will crash at runtime)**\n\nThis file calls `t(...)` in the error `Alert` but no longer imports it, so the component will throw when the error branch renders.","created_at":"2026-01-16T19:41:47Z","updated_at":"2026-01-16T19:41:47Z","html_url":"https://github.com/droid-code-review-evals/droid-grafana/pull/5#discussion_r2699751804","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/5","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699751804"},"html":{"href":"https://github.com/droid-code-review-evals/droid-grafana/pull/5#discussion_r2699751804"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/5"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-grafana/pulls/comments/2699751804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":43,"original_line":43,"side":"RIGHT","author_association":"NONE","original_position":42,"position":42,"subject_type":"line"}]