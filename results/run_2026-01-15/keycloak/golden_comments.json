[
  {
    "pr_title": "Fixing Re-authentication with passkeys",
    "comments": [
      {
        "comment": "ConditionalPasskeysEnabled() called without UserModel parameter",
        "severity": "Medium"
      },
      {
        "comment": "With isConditionalPasskeysEnabled(UserModel user) requiring user != null, authenticate(...) will not call webauthnAuth.fillContextForm(context) on the initial login page where context.getUser() is still null, so conditional passkey UI will not be set up for first-time passkey login. Consider whether this should also be enabled when no user has been selected yet so ID-less passkey authentication on the initial login form continues to work.",
        "severity": "Medium"
      }
    ]
  },
  {
    "pr_title": "Add caching support for IdentityProviderStorageProvider.getForLogin operations",
    "comments": [
      {
        "comment": "Recursive caching call using session instead of delegate",
        "severity": "Critical"
      },
      {
        "comment": "Cleanup reference uses incorrect alias - should be 'idp-alias-' + i instead of 'alias'.",
        "severity": "Medium"
      }
    ]
  },
  {
    "pr_title": "Add AuthzClientCryptoProvider for authorization client cryptographic operations",
    "comments": [
      {
        "comment": "Returns wrong provider (default keystore instead of BouncyCastle)",
        "severity": "High"
      },
      {
        "comment": "Dead code exists where ASN1Encoder instances are created and written to, but their results are immediately discarded. The actual encoding is performed by new ASN1Encoder instances created in the subsequent return statement, rendering the earlier operations useless.",
        "severity": "Low"
      }
    ]
  },
  {
    "pr_title": "Add rolling-updates feature flag and compatibility framework",
    "comments": [
      {
        "comment": "Incorrect method call for exit codes. The picocli.exit() method calls System.exit() directly, which is problematic:",
        "severity": "Medium"
      }
    ]
  },
  {
    "pr_title": "Add Client resource type and scopes to authorization schema",
    "comments": [
      {
        "comment": "Inconsistent feature flag bug causing orphaned permissions. The AdminPermissions event listener, responsible for cleaning up permissions upon role, client, or group removal, is incorrectly guarded by the ADMIN_FINE_GRAINED_AUTHZ (V1) feature flag. This is inconsistent with other methods in the class that use ADMIN_FINE_GRAINED_AUTHZ_V2. Consequently, if ADMIN_FINE_GRAINED_AUTHZ_V2 is enabled but V1 is not, the permission cleanup logic will not execute, leading to orphaned permission data. Cleanup should occur regardless of which fine-grained authorization version is enabled.",
        "severity": "High"
      },
      {
        "comment": "In hasPermission(ClientModel client, String scope), the resource lookup uses findByName(server, client.getId(), server.getId()), but AdminPermissionsSchema.getOrCreateResource creates per-client resources with the owner set to resourceServer.getClientId(), so this lookup will never find those resources and will always fall back to the 'all-clients' resource, effectively ignoring client-specific permissions.",
        "severity": "High"
      },
      {
        "comment": "In getClientsWithPermission(String scope), iterating resourceStore.findByType(server, AdminPermissionsSchema.CLIENTS_RESOURCE_TYPE) and returning resource.getName() will only ever consider the type-level 'Clients' resource (per-client resources have no type) and return its name, while AvailableRoleMappingResource#getRoleIdsWithPermissions expects actual client IDs to pass to realm.getClientById, which can lead to incorrect behavior or a null client and subsequent failures.",
        "severity": "High"
      }
    ]
  },
  {
    "pr_title": "Add Groups resource type and scopes to authorization schema",
    "comments": [
      {
        "comment": "Incorrect permission check in canManage() method",
        "severity": "High"
      },
      {
        "comment": "In getGroupIdsWithViewPermission, hasPermission is called with groupResource.getId() and the same groupResource.getId() is added to granted, but hasPermission resolves resources by name (treating the argument as a group id) and the GroupPermissionEvaluator contract says this method returns group IDs that are later used as UserModel.GROUPS and in getUsersCount group filters. This mismatch means per-group VIEW_MEMBERS/MANAGE_MEMBERS permissions may not yield the expected group IDs for filtering and counts, and evaluation may effectively only look at the type-level 'all-groups' resource; consider revisiting whether this should operate on the underlying group ids (resource names) instead so it aligns with the JPA queries and the interface contract.",
        "severity": "High"
      }
    ]
  },
  {
    "pr_title": "Add HTML sanitizer for translated message resources",
    "comments": [
      {
        "comment": "The translation is in Italian instead of Lithuanian. This should be translated to Lithuanian to match the file's locale (messages_lt.properties).",
        "severity": "Medium"
      },
      {
        "comment": "The totpStep1 value uses Traditional Chinese terms in the Simplified Chinese file (zh_CN), which is likely incorrect for this locale. Please verify the locale‑appropriate translation.",
        "severity": "Medium"
      },
      {
        "comment": "The anchor sanitization logic has a potential issue where it consumes English matcher groups without proper validation. If the translated text has more anchor tags than the English text, this could lead to incorrect validation results.",
        "severity": "Low"
      },
      {
        "comment": "The method name 'santizeAnchors' should be 'sanitizeAnchors' (missing 'i').",
        "severity": "Low"
      }
    ]
  },
  {
    "pr_title": "Implement access token context encoding framework",
    "comments": [
      {
        "comment": "Wrong parameter in null check (grantType vs. rawTokenId)",
        "severity": "Critical"
      },
      {
        "comment": "In isAccessTokenId, the substring for the grant shortcut and the equality check look inverted: the grant shortcut occupies indices 4–5 (substring(4,6)), and a match should return true (combined with UUID check), not false.",
        "severity": "High"
      },
      {
        "comment": "Javadoc mentions \"usually like 3-letters shortcut\" but some implementations use 2-letter shortcuts (\"ac\", \"cc\", \"rt\", \"te\", \"pc\", \"ci\", \"ro\"). Consider updating documentation to reflect actual usage pattern.",
        "severity": "Low"
      },
      {
        "comment": " Catching generic RuntimeException is too broad. The implementation throws IllegalArgumentException specifically - catch that instead for more precise testing.",
        "severity": "Low"
      }
    ]
  },
  {
    "pr_title": "Implement recovery key support for user storage providers",
    "comments": [
      {
        "comment": "Unsafe raw List deserialization without type safety. Calling Optional.get() directly on the Optional returned by RecoveryAuthnCodesUtils.getCredential(user) without checking isPresent() can lead to a NoSuchElementException if the Optional is empty.",
        "severity": "Medium"
      },
      {
        "comment": "After creating the RecoveryAuthnCodesCredentialModel, consider setting its id from the stored credential (e.g., myUser.recoveryCodes.getId()); otherwise getId() will be null and downstream removal by id (e.g., removeStoredCredentialById in the authenticator flow) may not work.",
        "severity": "Low"
      }
    ]
  },
  {
    "pr_title": "Fix concurrent group access to prevent NullPointerException",
    "comments": [
      {
        "comment": "Returning null from getSubGroupsCount() violates the GroupModel contract (Javadoc says it never returns null) and may lead to NPEs in callers that expect a non-null count.",
        "severity": "Critical"
      },
      {
        "comment": "The reader thread isn’t waited for; flipping deletedAll to true and asserting immediately can race and miss exceptions added just after the flag change, making this test flaky.",
        "severity": "Medium"
      }
    ]
  }
]
