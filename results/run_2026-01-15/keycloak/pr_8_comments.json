[{"url":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/comments/2699750395","pull_request_review_id":3672446150,"id":2699750395,"node_id":"PRRC_kwDOQ4pSo86g6uv7","diff_hunk":"@@ -469,6 +473,24 @@ public void describeTo(Description description) {\n         };\n     }\n \n+    public static Matcher<String> isAccessTokenId(String expectedGrantShortcut) {\n+        return new TypeSafeMatcher<String>() {\n+            @Override\n+            protected boolean matchesSafely(String item) {\n+                String[] items = item.split(\":\");\n+                if (items.length != 2) return false;\n+                // Grant type shortcut starts at character 4th char and is 2-chars long\n+                if (items[0].substring(3, 5).equals(expectedGrantShortcut)) return false;\n+                return isUUID().matches(items[1]);\n+            }","path":"testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/AssertEvents.java","commit_id":"c8738721df2cd2d16fe16adec571b4192354a771","original_commit_id":"c8738721df2cd2d16fe16adec571b4192354a771","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P0] Fix inverted grant-shortcut check in `isAccessTokenId`**\n\n`matchesSafely` currently returns `false` when the grant shortcut *matches* (`equals(expectedGrantShortcut)`), which makes all callers expecting a specific grant fail. The check should be negated (or the return values swapped) so it fails only when the shortcut differs.","created_at":"2026-01-16T19:41:17Z","updated_at":"2026-01-16T19:41:17Z","html_url":"https://github.com/droid-code-review-evals/droid-keycloak/pull/8#discussion_r2699750395","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/comments/2699750395"},"html":{"href":"https://github.com/droid-code-review-evals/droid-keycloak/pull/8#discussion_r2699750395"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/comments/2699750395/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":485,"original_line":485,"side":"RIGHT","author_association":"NONE","original_position":60,"position":60,"subject_type":"line"},{"url":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/comments/2699750616","pull_request_review_id":3672446603,"id":2699750616,"node_id":"PRRC_kwDOQ4pSo86g6uzY","diff_hunk":"@@ -0,0 +1,95 @@\n+/*\n+ * Copyright 2025 Red Hat, Inc. and/or its affiliates\n+ *  and other contributors as indicated by the @author tags.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+\n+package org.keycloak.protocol.oidc.encode;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Some context info about the token\n+ *\n+ * @author <a href=\"mailto:mposolda@redhat.com\">Marek Posolda</a>\n+ */\n+public class AccessTokenContext {\n+\n+    private final SessionType sessionType;\n+    private final TokenType tokenType;\n+    private final String grantType;\n+    private final String rawTokenId;\n+\n+    public enum SessionType {\n+        ONLINE(\"on\"),\n+        OFFLINE(\"of\"),\n+        TRANSIENT(\"tr\"),\n+        UNKNOWN(\"un\");\n+\n+        private final String shortcut;\n+\n+        SessionType(String shortcut) {\n+            this.shortcut = shortcut;\n+        }\n+\n+        public String getShortcut() {\n+            return shortcut;\n+        }\n+    }\n+\n+    public enum TokenType {\n+        REGULAR(\"rt\"),\n+        LIGHTWEIGHT(\"lt\"),\n+        UNKNOWN(\"un\");\n+\n+        private final String shortcut;\n+\n+        TokenType(String shortcut) {","path":"services/src/main/java/org/keycloak/protocol/oidc/encode/AccessTokenContext.java","commit_id":"c8738721df2cd2d16fe16adec571b4192354a771","original_commit_id":"c8738721df2cd2d16fe16adec571b4192354a771","user":{"login":"factory-droid[bot]","id":138933559,"node_id":"BOT_kgDOCEf1Nw","avatar_url":"https://avatars.githubusercontent.com/in/358017?v=4","gravatar_id":"","url":"https://api.github.com/users/factory-droid%5Bbot%5D","html_url":"https://github.com/apps/factory-droid","followers_url":"https://api.github.com/users/factory-droid%5Bbot%5D/followers","following_url":"https://api.github.com/users/factory-droid%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/factory-droid%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/factory-droid%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/factory-droid%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/factory-droid%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/factory-droid%5Bbot%5D/repos","events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/factory-droid%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"body":"**[P1] Fix null-check for `rawTokenId` in constructor**\n\nThe constructor calls `Objects.requireNonNull(grantType, \"Null rawTokenId not allowed\")` instead of checking `rawTokenId`, so a null raw ID would slip through and potentially NPE later (e.g., during encoding).","created_at":"2026-01-16T19:41:22Z","updated_at":"2026-01-16T19:41:22Z","html_url":"https://github.com/droid-code-review-evals/droid-keycloak/pull/8#discussion_r2699750616","pull_request_url":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/8","_links":{"self":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/comments/2699750616"},"html":{"href":"https://github.com/droid-code-review-evals/droid-keycloak/pull/8#discussion_r2699750616"},"pull_request":{"href":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/8"}},"reactions":{"url":"https://api.github.com/repos/droid-code-review-evals/droid-keycloak/pulls/comments/2699750616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"start_line":null,"original_start_line":null,"start_side":null,"line":60,"original_line":60,"side":"RIGHT","author_association":"NONE","original_position":60,"position":60,"subject_type":"line"}]