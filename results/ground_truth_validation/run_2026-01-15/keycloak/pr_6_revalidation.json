{
  "pr_number": 6,
  "pr_title": "Add Groups resource type and scopes to authorization schema",
  "revalidation_date": "2026-01-20",
  "bug_verdicts": [
    {
      "bug_id": 1,
      "original_description": "canManage() incorrectly accepts VIEW permission - privilege escalation",
      "file": "services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionsV2.java",
      "line": 70,
      "original_severity": "medium",
      "original_source": "both",
      "verdict": "modified",
      "verified_file": "services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionsV2.java",
      "verified_line": 70,
      "verified_severity": "high",
      "verified_bug_type": "security",
      "verified_description": "GroupPermissionsV2.canManage() treats the 'view' scope as sufficient for manage access on the Groups resource type, so endpoints that call requireManage() (e.g., creating top-level groups) can be reached with view-only permissions.",
      "notes": "Confirmed: canManage() returns hasPermission(null, VIEW, MANAGE) at line 70, so any granted VIEW permission on the Groups resource-type resource satisfies manage checks. Severity upgraded to HIGH due to authorization/privilege escalation. Note: GH PR title differs from draft JSON title." 
    },
    {
      "bug_id": 2,
      "original_description": "getGroupIdsWithViewPermission uses resource ID instead of group ID (resource name), causing permission filtering to fail",
      "file": "services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionsV2.java",
      "line": 120,
      "original_severity": "medium",
      "original_source": "golden_only",
      "verdict": "modified",
      "verified_file": "services/src/main/java/org/keycloak/services/resources/admin/permissions/GroupPermissionsV2.java",
      "verified_line": 122,
      "verified_severity": "medium",
      "verified_bug_type": "logic_bug",
      "verified_description": "getGroupIdsWithViewPermission passes the authorization resource id to hasPermission (which looks up by resource name), and returns authorization resource ids instead of group ids; downstream user queries treat these values as group ids and incorrectly return 0 results.",
      "notes": "Confirmed: uses groupResource.getId() for both the permission check and granted.add(...) (lines 122-123). AdminPermissionsSchema group resources are named by groupId, while getUsersCount(..., groupIds) expects actual group ids, so mismatched ids break filtering. Adjusted verified_line to the exact call site."
    }
  ],
  "false_positive_verdicts": [],
  "newly_discovered_bugs": []
}
